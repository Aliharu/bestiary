<h3>
  <mat-form-field>
    <input placeholder="Weapon Name (if blank, it will appears as '{{displayName()}}')" matInput [value]="square.weapon"
      (change)="captureInput($event, 'weapon')">
  </mat-form-field>
</h3>
<div class="edit-combat-squares-shell">
  <div>
    <div class="square-shell">
      <img *ngIf="square.weapontype === 'm'" class="combat-image" src="../../../../assets/square.png" alt="combat square">
      <img *ngIf="square.weapontype === 'r'" class="combat-image" src="../../../../assets/rangedsquare.png" alt="combat square">
      <p class="spd">{{calculateRecovery(selectedRole.spdbonus, square.selectedweapon, square.weaponInfo, square.addrolemods, selectedRole.spd, square.spd, square.selectedarmor, square.armorInfo)}}</p>
      <p class="atk">{{(square.weapontype === 'm' ? selectedRole.atk && square.addrolemods ? selectedRole.atk : 0 :
        selectedRole.rangedAtk && square.addrolemods ? selectedRole.rangedAtk : 0) + square.atk}}</p>
      <p class="init">{{(square.selectedarmor ? square.armorInfo.init : selectedRole.init && square.addrolemods ?
        selectedRole.init : 0) + square.init}}</p>
      <p class="def">{{displayedDefense}}</p>
      <p class="fatigue">{{ square.selectedweapon ? square.weaponInfo.type : square.damagetype }}</p>
      <div class="dr">
        <p>{{displayedDR}}</p>
        <p class="shield_dr" *ngIf="displayedShieldDR && displayedShieldDR"><img class="shield-dr" src="./assets/shield.svg" alt="shield dr" width="15" height="15">{{displayedShieldDR}}</p>
      </div>
      <div class="measure">
        <p *ngIf="square.weapontype !== 'r'">{{(square.selectedweapon ? square.weaponInfo.measure : selectedRole.measure
          && square.addrolemods ? selectedRole.measure : 0) + square.measure + returnSizeMeasureModifier()}}</p>
        <p *ngIf="square.weapontype === 'r'">{{(square.selectedweapon ? square.weaponInfo.range : selectedRole.ranges &&
          square.addrolemods ? selectedRole.ranges.increment : 0) + square.ranges.increment}}ri <i
            class="fas fa-info-circle icon-small blue" matTooltip="Stands for Range Increment. 
            Between 5 ft and {{(square.selectedweapon ? square.weaponInfo.range : selectedRole.ranges && square.addrolemods ? selectedRole.ranges.increment : 0) + square.ranges.increment}} ft, -0 atk penalty. 
            Between {{(square.selectedweapon ? square.weaponInfo.range : selectedRole.ranges && square.addrolemods ? selectedRole.ranges.increment : 0) + square.ranges.increment + 1}} ft and {{((square.selectedweapon ? square.weaponInfo.range : selectedRole.ranges && square.addrolemods ? selectedRole.ranges.increment : 0) + square.ranges.increment) * 2}} ft, -2 atk penalty.
            Between {{(((square.selectedweapon ? square.weaponInfo.range : selectedRole.ranges && square.addrolemods ? selectedRole.ranges.increment : 0) + square.ranges.increment) * 2) + 1}} ft and {{((square.selectedweapon ? square.weaponInfo.range : selectedRole.ranges && square.addrolemods ? selectedRole.ranges.increment : 0) + square.ranges.increment) * 3}} ft, -4 atk penalty.
            and so on." matTooltipClass="my-tooltip"></i></p>
      </div>
      <p *ngIf="!square.newDamage.isSpecial" class="damage">{{displayedDamage}}</p>
      <p *ngIf="square.newDamage.isSpecial" class="damage specialDamage">*See Attack Info Below</p>
      <p class="parry">{{square.showmaxparry ? 'EUA' : (square.selectedshield ? square.shieldInfo.parry :
        square.selectedweapon && square.weaponInfo.parry ? square.weaponInfo.parry : selectedRole.parry &&
        square.addrolemods ? selectedRole.parry : 0) + square.parry}}</p>
    </div>
    <mat-form-field>
      <mat-label>Range Type</mat-label>
      <mat-select [disabled]="square.selectedweapon" [value]="square.weapontype"
        (selectionChange)="captureSelect($event, 'weapontype')">
        <mat-option value="m">
          Melee
        </mat-option>
        <mat-option value="r">
          Ranged
        </mat-option>
      </mat-select>
    </mat-form-field>
  </div>
  <div class="edit-combat-squares-shell-right">
    <section *ngIf="selectedRole.spd">
      <mat-checkbox [checked]="square.addrolemods" (change)="checkCheckbox('addrolemods', $event.checked)">Role
        Modifiers Added</mat-checkbox>
    </section>
    <section>
      <mat-checkbox [checked]="square.addsizemod" (change)="checkCheckbox('addsizemod', $event.checked)">Size Modifiers
        Added</mat-checkbox>
    </section>
    <br>
    <div>
      <h3>Selected Weapons, Armor, and Shields</h3>
      <div class="divider white"></div>

      <div class="equipment-choices">
        <div *ngIf="!showAllEquipment && selectedRole.spd && selectedRole.weapons.length > 0">
          <mat-form-field>
            <mat-label>Weapon Choices</mat-label>
            <mat-select [value]="square.selectedweapon" (selectionChange)="captureSelect($event, 'selectedweapon')">
              <mat-option>None</mat-option>
              <mat-optgroup *ngFor="let group of selectedRole.weapons" [label]="group.label">
                <mat-option *ngFor="let item of group.items" [value]="item">
                  {{item}}
                </mat-option>
              </mat-optgroup>
            </mat-select>
          </mat-form-field>
        </div>
        <div *ngIf="showAllEquipment || !selectedRole.spd || !selectedRole.weapons.length > 0">
          <mat-form-field>
            <mat-label>Weapon Choices</mat-label>
            <mat-select [value]="square.selectedweapon" (selectionChange)="captureSelect($event, 'selectedweapon')">
              <mat-option>None</mat-option>
              <mat-optgroup *ngFor="let group of equipmentLists.weapons" [label]="group.label">
                <mat-option *ngFor="let item of group.items" [value]="item">
                  {{item}}
                </mat-option>
              </mat-optgroup>
            </mat-select>
          </mat-form-field>
        </div>
  
        <div *ngIf="!showAllEquipment && selectedRole.spd">
          <mat-form-field *ngIf="selectedRole.armor && selectedRole.armor.length > 0">
            <mat-label>Armor Choices</mat-label>
            <mat-select [value]="square.selectedarmor" (selectionChange)="captureSelect($event, 'selectedarmor')">
              <mat-option>None</mat-option>
              <mat-option *ngFor="let item of selectedRole.armor" [value]="item">
                {{item}}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div *ngIf="showAllEquipment || !selectedRole.spd">
          <mat-form-field>
            <mat-label>Armor Choices</mat-label>
            <mat-select [value]="square.selectedarmor" (selectionChange)="captureSelect($event, 'selectedarmor')">
              <mat-option>None</mat-option>
              <mat-optgroup *ngFor="let group of equipmentLists.armor" [label]="group.label">
                <mat-option *ngFor="let item of group.items" [value]="item">
                  {{item}}
                </mat-option>
              </mat-optgroup>
            </mat-select>
          </mat-form-field>
        </div>
  
        <div *ngIf="!showAllEquipment && selectedRole.spd">
          <mat-form-field *ngIf="selectedRole.shields && selectedRole.shields.length > 0">
            <mat-label>Shield Choices</mat-label>
            <mat-select [value]="square.selectedshield" (selectionChange)="captureSelect($event, 'selectedshield')">
              <mat-option>None</mat-option>
              <mat-option *ngFor="let item of selectedRole.shields" [value]="item">
                {{item}}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div *ngIf="showAllEquipment || !selectedRole.spd">
          <mat-form-field>
            <mat-label>Shield Choices</mat-label>
            <mat-select [value]="square.selectedshield" (selectionChange)="captureSelect($event, 'selectedshield')">
              <mat-option>None</mat-option>
              <mat-optgroup *ngFor="let group of equipmentLists.shields" [label]="group.label">
                <mat-option *ngFor="let item of group.items" [value]="item">
                  {{item}}
                </mat-option>
              </mat-optgroup>
            </mat-select>
          </mat-form-field>
        </div>
      </div>

      <section *ngIf="selectedRole.spd">
        <mat-checkbox [checked]="showAllEquipment" (change)="checkCheckbox('showAllEquipment', $event.checked)">Show me
          all weapons/armor/shields</mat-checkbox>
      </section>
      <br>
    </div>
    <div class="square-combat-shell">
      <h3>Combat Metrics</h3>
      <div class="divider white"></div>
      <mat-form-field>
        <input
          id="{{selectedRole.strengths && selectedRole.strengths.includes('Recovery') ? 'green' : selectedRole.weaknesses && selectedRole.weaknesses.includes('Recovery') ? 'red' : ''}}"
          placeholder="Recovery (2 points)" matInput [value]="square.spd" (change)="captureInputNumber($event, 'spd')">
      </mat-form-field>
      <mat-form-field *ngIf="square.weapontype === 'm'">
        <input
          id="{{selectedRole.strengths && selectedRole.strengths.includes('Melee Attack') ? 'green' : selectedRole.weaknesses && selectedRole.weaknesses.includes('Melee Attack') ? 'red' : ''}}"
          placeholder="Attack (1 point)" matInput [value]="square.atk" (change)="captureInputNumber($event, 'atk')">
      </mat-form-field>
      <mat-form-field *ngIf="square.weapontype === 'r'">
        <input
          id="{{selectedRole.strengths && selectedRole.strengths.includes('Ranged Attack') ? 'green' : selectedRole.weaknesses && selectedRole.weaknesses.includes('Ranged Attack') ? 'red' : ''}}"
          placeholder="Attack (1 point)" matInput [value]="square.atk" (change)="captureInputNumber($event, 'atk')">
      </mat-form-field>
      <mat-form-field>
        <input placeholder="Initiative (1 point)" matInput [value]="square.init"
          (change)="captureInputNumber($event, 'init')">
      </mat-form-field>
      <div class="input-with-tooltip-shell">
        <mat-form-field>
          <input
            id="{{selectedRole.strengths && selectedRole.strengths.includes('Defense') ? 'green' : selectedRole.weaknesses && selectedRole.weaknesses.includes('Defense') ? 'red' : ''}}"
            placeholder="Defense (1 point; max +10)" matInput [value]="square.def"
            (change)="captureInputNumber($event, 'def')">
        </mat-form-field>
        <i class="fas fa-info-circle icon-small blue" matTooltip="The monster's size is factored into Defense."
          matTooltipClass="my-tooltip"></i>
      </div>
      <div class="input-with-tooltip-shell" *ngIf="square.weapontype === 'm'">
        <mat-form-field>
          <input
            id="{{selectedRole.strengths && selectedRole.strengths.includes('Measure') ? 'green' : selectedRole.weaknesses && selectedRole.weaknesses.includes('Measure') ? 'red' : ''}}"
            placeholder="Measure (1 point)" matInput [value]="square.measure"
            (change)="captureInputNumber($event, 'measure')">
        </mat-form-field>
        <i class="fas fa-info-circle icon-small blue" matTooltip="The monster's size is factored into Measure."
          matTooltipClass="my-tooltip"></i>
      </div>
      <mat-form-field *ngIf="square.weapontype === 'r'">
        <input
          id="{{selectedRole.strengths && selectedRole.strengths.includes('Ranged Penalties') ? 'green' : selectedRole.weaknesses && selectedRole.weaknesses.includes('Ranged Penalties') ? 'red' : ''}}"
          placeholder="Range Increment (1 point / 10 ft)" matInput [value]="square.ranges.increment"
          (change)="captureInputNumber($event, 'ranges', 'increment')">
      </mat-form-field>
      <mat-form-field>
        <mat-label>Damage Type</mat-label>
        <mat-select [disabled]="square.selectedweapon"
          [value]="square.selectedweapon ? square.weaponInfo.type : square.damagetype"
          (selectionChange)="captureSelect($event, 'damagetype')">
          <mat-option>
            None
          </mat-option>
          <mat-option value="S">
            Slashing
          </mat-option>
          <mat-option value="P">
            Piercing
          </mat-option>
          <mat-option value="C">
            Crushing
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <div>
      <h3>Armor</h3>
      <div class="divider white"></div>
      <div>
        <mat-form-field>
          <input
            id="{{selectedRole.strengths && selectedRole.strengths.includes('/DR') ? 'green' : selectedRole.weaknesses && selectedRole.weaknesses.includes('/DR') ? 'red' : ''}}"
            placeholder="/DR (4 points)" matInput [value]="square.newDR.slash"
            (change)="captureInputNumber($event, 'newDR', 'slash')">
        </mat-form-field>
        <mat-form-field>
          <input
            id="{{selectedRole.strengths && selectedRole.strengths.includes('DR') ? 'green' : selectedRole.weaknesses && selectedRole.weaknesses.includes('DR') ? 'red' : ''}}"
            placeholder="DR (1 point)" matInput [value]="square.newDR.flat"
            (change)="captureInputNumber($event, 'newDR', 'flat')">
        </mat-form-field>
      </div>
    </div>
    <div>
      <h3>Parry/Shield</h3>
      <div class="divider white"></div>
      <div>
        <mat-form-field *ngIf="!square.showmaxparry">
          <input
            id="{{selectedRole.strengths && selectedRole.strengths.includes('Parry') ? 'green' : selectedRole.weaknesses && selectedRole.weaknesses.includes('Parry') ? 'red' : ''}}"
            placeholder="Parry (1 point)" matInput [value]="square.parry"
            (change)="captureInputNumber($event, 'parry')">
        </mat-form-field>
        <mat-form-field>
          <input
            id="{{selectedRole.strengths && selectedRole.strengths.includes('Parry DR') ? 'green' : selectedRole.weaknesses && selectedRole.weaknesses.includes('Parry DR') ? 'red' : ''}}"
            placeholder="Parry /DR (2 points)" matInput [value]="square.newShieldDr.slash"
            (change)="captureInputNumber($event, 'newShieldDr', 'slash')">
        </mat-form-field>
        <mat-form-field>
          <input
            id="{{selectedRole.strengths && selectedRole.strengths.includes('Parry /DR') ? 'green' : selectedRole.weaknesses && selectedRole.weaknesses.includes('Parry /DR') ? 'red' : ''}}"
            placeholder="Parry DR (1 point)" matInput [value]="square.newShieldDr.flat"
            (change)="captureInputNumber($event, 'newShieldDr', 'flat')">
        </mat-form-field>
      </div>
      <section>
        <mat-checkbox [checked]="square.showmaxparry" (change)="checkCheckbox('showmaxparry', $event.checked)">'Except
          Unarmed Attacks' Parry</mat-checkbox> <i class="fas fa-info-circle icon-small blue"
          matTooltip="Every attack is parried except unarmed attacks" matTooltipClass="my-tooltip"></i>
        <br>
        <br>
      </section>
    </div>
    <div>
      <h3>Damage</h3>
      <div class="divider white"></div>
      <section *ngIf="!square.newDamage.isSpecial">
        <mat-checkbox [checked]="square.dontaddroledamage"
          (change)="checkCheckbox('dontaddroledamage', $event.checked)">Remove Damage Dice from Role</mat-checkbox>
      </section>
      <section>
        <mat-checkbox [checked]="square.newDamage.isSpecial" (change)="checkCheckbox('isSpecial', $event.checked)">Is a
          Special Attack</mat-checkbox>
      </section>
      <div *ngIf="!square.newDamage.isSpecial">
        <section>
          <mat-checkbox [checked]="square.newDamage.hasSpecialAndDamage"
            (change)="checkCheckbox('hasSpecialAndDamage', $event.checked)">Part of the Attack is Special</mat-checkbox>
        </section>

        <br>
        <div class="damage-skill-shell" *ngIf="square.weapontype === 'm'">
          <mat-form-field>
            <input
              id="{{selectedRole.strengths && selectedRole.strengths.includes('Melee Damage') ? 'green' : selectedRole.weaknesses && selectedRole.weaknesses.includes('Melee Damage') ? 'red' : ''}}"
              placeholder="Damage Skill ({{returnPointValueForDamageSkills()}} point{{returnPointValueForDamageSkills() === 2 ? 's' : ''}})"
              matInput [value]="square.damageskill" (change)="captureInputNumber($event, 'damageskill')">
          </mat-form-field>
          <p class="p-subtitle">{{addedDice()}}</p>
          <i class="fas fa-info-circle icon-small blue" matTooltip="This behaves like the Damage Advanced Skill"
            matTooltipClass="my-tooltip"></i>
        </div>
        <div class="damage-skill-shell" *ngIf="square.weapontype === 'r'">
          <mat-form-field>
            <input
              id="{{selectedRole.strengths && selectedRole.strengths.includes('Ranged Damage') ? 'green' : selectedRole.weaknesses && selectedRole.weaknesses.includes('Ranged Damage') ? 'red' : ''}}"
              placeholder="Damage Skill ({{returnPointValueForDamageSkills()}} point{{returnPointValueForDamageSkills() === 2 ? 's' : ''}})"
              matInput [value]="square.damageskill" (change)="captureInputNumber($event, 'damageskill')">
          </mat-form-field>
          <p class="p-subtitle">{{addedDice()}}</p>
          <i class="fas fa-info-circle icon-small blue" matTooltip="This behaves like the Damage Advanced Skill"
            matTooltipClass="my-tooltip"></i>
        </div>
        <div *ngIf="squareDamageArray.length > 0">
          <p class="p-subtitle">Click to remove 1 dice</p>
          <mat-chip-list>
            <div *ngFor="let dice of squareDamageArray; let i = index">
              <mat-chip (click)="removeChip(dice.type)" color="warn" selected>
                {{dice.number}}d{{dice.type}}!
              </mat-chip>
            </div>
          </mat-chip-list>
          <br>
        </div>
        <div>
          <div *ngIf="square.weapontype === 'm'" class="marginBottom">
            <p class="p-subtitle"> Click to add 1 dice</p>
            <button mat-raised-button
              id="{{selectedRole.strengths && selectedRole.strengths.includes('Melee Damage') ? 'green' : selectedRole.weaknesses && selectedRole.weaknesses.includes('Melee Damage') ? 'red' : ''}}"
              (click)="addChip('3')">d3! (1 point)</button>
            <button mat-raised-button
              id="{{selectedRole.strengths && selectedRole.strengths.includes('Melee Damage') ? 'green' : selectedRole.weaknesses && selectedRole.weaknesses.includes('Melee Damage') ? 'red' : ''}}"
              (click)="addChip('4')">d4! (1 point)</button>
            <button mat-raised-button
              id="{{selectedRole.strengths && selectedRole.strengths.includes('Melee Damage') ? 'green' : selectedRole.weaknesses && selectedRole.weaknesses.includes('Melee Damage') ? 'red' : ''}}"
              (click)="addChip('6')">d6! (2 points)</button>
            <button mat-raised-button
              id="{{selectedRole.strengths && selectedRole.strengths.includes('Melee Damage') ? 'green' : selectedRole.weaknesses && selectedRole.weaknesses.includes('Melee Damage') ? 'red' : ''}}"
              (click)="addChip('8')">d8! (2 points)</button>
            <button mat-raised-button
              id="{{selectedRole.strengths && selectedRole.strengths.includes('Melee Damage') ? 'green' : selectedRole.weaknesses && selectedRole.weaknesses.includes('Melee Damage') ? 'red' : ''}}"
              (click)="addChip('10')">d10! (3 points)</button>
            <button mat-raised-button
              id="{{selectedRole.strengths && selectedRole.strengths.includes('Melee Damage') ? 'green' : selectedRole.weaknesses && selectedRole.weaknesses.includes('Melee Damage') ? 'red' : ''}}"
              (click)="addChip('12')">d12! (4 points)</button>
            <button mat-raised-button
              id="{{selectedRole.strengths && selectedRole.strengths.includes('Melee Damage') ? 'green' : selectedRole.weaknesses && selectedRole.weaknesses.includes('Melee Damage') ? 'red' : ''}}"
              (click)="addChip('20')">d20! (6 points)</button>
          </div>
          <div *ngIf="square.weapontype === 'r'" class="marginBottom">
            <button mat-raised-button
              id="{{selectedRole.strengths && selectedRole.strengths.includes('Ranged Damage') ? 'green' : selectedRole.weaknesses && selectedRole.weaknesses.includes('Ranged Damage') ? 'red' : ''}}"
              (click)="addChip('3')">d3! (1 point)</button>
            <button mat-raised-button
              id="{{selectedRole.strengths && selectedRole.strengths.includes('Ranged Damage') ? 'green' : selectedRole.weaknesses && selectedRole.weaknesses.includes('Ranged Damage') ? 'red' : ''}}"
              (click)="addChip('4')">d4! (1 point)</button>
            <button mat-raised-button
              id="{{selectedRole.strengths && selectedRole.strengths.includes('Ranged Damage') ? 'green' : selectedRole.weaknesses && selectedRole.weaknesses.includes('Ranged Damage') ? 'red' : ''}}"
              (click)="addChip('6')">d6! (2 points)</button>
            <button mat-raised-button
              id="{{selectedRole.strengths && selectedRole.strengths.includes('Ranged Damage') ? 'green' : selectedRole.weaknesses && selectedRole.weaknesses.includes('Ranged Damage') ? 'red' : ''}}"
              (click)="addChip('8')">d8! (2 points)</button>
            <button mat-raised-button
              id="{{selectedRole.strengths && selectedRole.strengths.includes('Ranged Damage') ? 'green' : selectedRole.weaknesses && selectedRole.weaknesses.includes('Ranged Damage') ? 'red' : ''}}"
              (click)="addChip('10')">d10! (3 points)</button>
            <button mat-raised-button
              id="{{selectedRole.strengths && selectedRole.strengths.includes('Ranged Damage') ? 'green' : selectedRole.weaknesses && selectedRole.weaknesses.includes('Ranged Damage') ? 'red' : ''}}"
              (click)="addChip('12')">d12! (4 points)</button>
            <button mat-raised-button
              id="{{selectedRole.strengths && selectedRole.strengths.includes('Ranged Damage') ? 'green' : selectedRole.weaknesses && selectedRole.weaknesses.includes('Ranged Damage') ? 'red' : ''}}"
              (click)="addChip('20')">d20! (6 points)</button>
          </div>
        </div>
        <mat-form-field>
          <input
            id="{{selectedRole.strengths && selectedRole.strengths.includes('Melee Damage') ? 'green' : selectedRole.weaknesses && selectedRole.weaknesses.includes('Melee Damage') ? 'red' : ''}}"
            placeholder="Flat Damage Modifier (1 point)" matInput [value]="square.newDamage.flat"
            (change)="captureInputNumber($event, 'newDamage', 'flat')">
        </mat-form-field>
      </div>
    </div>
  </div>
</div>

<!-- --------------------------------------------------------------------------------------------------- -->
<!-- --------------------------------------------------------------------------------------------------- -->
<!-- --------------------------------------------------------------------------------------------------- -->
<!-- --------------------------------------------------------------------------------------------------- -->
<!-- --------------------------------------------------------------------------------------------------- -->
<!-- --------------------------------------------------------------------------------------------------- -->
<!-- --------------------------------------------------------------------------------------------------- -->
<!-- ------------------------------------------------------------------------------------------------------------- -->


<!-- --------------------------------------------------------------------------------------------------- -->
<!-- --------------------------------------------------------------------------------------------------- -->
<!-- --------------------------------------------------------------------------------------------------- -->
<!-- --------------------------------------------------------------------------------------------------- -->
<!-- --------------------------------------------------------------------------------------------------- -->
<!-- --------------------------------------------------------------------------------------------------- -->
<!-- --------------------------------------------------------------------------------------------------- -->
<button mat-raised-button (click)="copyWeaponSquare(square)" color="accent"
  matTooltip="Copy {{displayName() === '' ? 'weapon' : displayName()}}"><i class="fa-solid fa-clone"></i></button>
<button mat-raised-button (click)="removeNewSecondaryItem('combat', index)" color="warn"><i
    class="fa-solid fa-minus"></i></button>